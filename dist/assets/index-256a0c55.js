import{B as T,E as te,F as q,G as se,r as b,H as ne,J as oe,K as ie,L as ce,O as J,Q as re,d as ae}from"./react-a54200d0.js";import{M as le,m as de,a as ue,g as ge,H as he}from"./code-highlight-1d1299a6.js";import{x as fe}from"./vendor-f472176f.js";import{B as j,C as me,M as z,A as V,a as _e,b as A,U as pe,S as k,c as P,I as Y,P as ve,D as be,d as ye,L as I}from"./ant-843c0ce5.js";import"./lodash-396ef1a6.js";import"./index-256a0c55.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();var Ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const O=T.Fragment,t=T.jsx,r=T.jsxs;const we="_container_by9wd_1",xe="_logo_by9wd_7",Se="_title_by9wd_21",Ne="_blink_by9wd_1",L={container:we,logo:xe,title:Se,blink:Ne},Ce="/assets/chatgpt-logo-af7ec635.svg";function je(){const e=te(),s=o=>{o.code==="Enter"&&e("/chatai")};return window.removeEventListener("keyup",s),window.addEventListener("keyup",s),r("div",{className:L.container,children:[r("div",{className:L.logo,children:[t("img",{src:Ce,style:{width:38}}),t("h1",{children:"GPT-4："})]}),t("h1",{className:L.title,children:"What do you want to do ?"})]})}const K={"input-box":"_input-box_2s0xp_1","btn-send":"_btn-send_2s0xp_4"},ke="/assets/chatgpt-icon-5f52f53f.svg",Pe="/assets/chatgpt-logo-af7ec635.svg",Le="/assets/chatgpt-plus-icon-47242499.svg",Ie="/assets/github-4e0d3f71.svg",Oe="/assets/hongbao-5b4c1fa1.jpg",Re="/assets/message-c4de63a4.svg",$e="/assets/new-user-560x300-e92086dd.jpg",De="/assets/react-35ef61ed.svg",Te="/assets/rhino-design-560x300-b4d777e1.png",qe="/assets/send-plus-ffbce2c7.svg",Ae="/assets/send-9a7ea57f.svg",Be="/assets/tencent-893fb934.jpg",Me="/assets/user-header-a888db8c.svg",Ee="/assets/vip-f0615d78.svg",m=e=>new URL(Object.assign({"../assets/chatgpt-icon.svg":ke,"../assets/chatgpt-logo.svg":Pe,"../assets/chatgpt-plus-icon.svg":Le,"../assets/github.svg":Ie,"../assets/hongbao.jpg":Oe,"../assets/message.svg":Re,"../assets/new-user-560x300.jpg":$e,"../assets/react.svg":De,"../assets/rhino-design-560x300.png":Te,"../assets/send-plus.svg":qe,"../assets/send.svg":Ae,"../assets/tencent.jpg":Be,"../assets/user-header.svg":Me,"../assets/vip.svg":Ee})[`../assets/${e}`],self.location).href,B=e=>{if(Number.isInteger(e)){const s=new Date(e),o=s.getFullYear(),i=`0${s.getMonth()+1}`.slice(-2),n=`0${s.getDate()+1}`.slice(-2),c=s.getHours(),a=`0${s.getMinutes()}`.slice(-2),f=`0${s.getSeconds()}`.slice(-2);return`${o}-${i}-${n} ${c}:${a}:${f}`}else return e},Fe=()=>{const{userAgent:e}=window.navigator;return!!~e.indexOf("iPhone")||!!~e.indexOf("Android")},M=()=>{const e=localStorage.getItem("plus");return e?JSON.parse(e):null},E=()=>{var e;return((e=M())==null?void 0:e.expire)>Date.now()},Ue="chats";function F(){return Number(localStorage.getItem("indexedDBversion")||1)}function He(e){localStorage.setItem("indexedDBversion",e)}function S(e=F()){return new Promise((s,o)=>{const n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(Ue,e);n.onsuccess=function(c){console.log("数据库打开成功");const a=c.target.result;s(a)},n.onerror=function(c){console.log("数据库打开报错",c),o(c)},n.onupgradeneeded=function(c){console.log("onupgradeneeded");const a=c.target.result;He(a.version),s(a)}})}function N(e){e.close(),console.log("数据库已关闭")}async function R(e){const s=F(),o=await S(s),i=o.objectStoreNames.contains(e);return N(o),i}async function Q(e,s){const o=F(),i=await S(o+1),n=i.createObjectStore(e,{keyPath:"sequence_id",autoIncrement:!0});return n.createIndex("id","id",{unique:!1}),n.createIndex("created_time","created_time",{unique:!1}),s.forEach(c=>n.createIndex(c,c,{unique:!1})),N(i),!0}async function $(e,s){const o=await S();return new Promise((i,n)=>{const c={...s,created_time:Date.now()};c.id||Object.assign(c,{id:fe()});const a=o.transaction([e],"readwrite").objectStore(e).add(c);a.onsuccess=function(){console.log("数据写入成功"),N(o),i(c)},a.onerror=function(){console.log("数据写入失败"),n(!1)}})}async function W(e){const s=await S(),o=s.transaction(e,"readwrite").objectStore(e);return new Promise(i=>{const n=[],c=o.openCursor();c.onsuccess=function(a){const f=a.target.result;f?(n.push(f.value),f.continue()):(console.log("游标读取的数据：",n),N(s),i(n))}})}async function Ge(e,s,o){const i=await S(),n=i.transaction(e,"readwrite").objectStore(e);return new Promise((c,a)=>{const f=n.index(s).openCursor(IDBKeyRange.only(o));f.onsuccess=function(d){const h=d.target.result;let l;h&&(l=h.delete(),l.onerror=function(){console.log("游标删除该记录失败")},l.onsuccess=function(){console.log("游标删除该记录成功"),N(i),c(!0)},h.continue())},f.onerror=function(d){a(d)}})}class X{constructor(){this.storeName="store_session_list"}async get(){return await R(this.storeName)?W(this.storeName):(await this.createSessionListStore(),[])}async createSessionListStore(){if(!await R(this.storeName))return await Q(this.storeName,["store_name","title"])}async addData(s){return await $(this.storeName,s)}async removeData(s){return await Ge(this.storeName,"id",s)}}const Je="_container_hxd3v_1",Ke="_icon_hxd3v_34",ze="_focus_hxd3v_40",v={container:Je,"btn-add":"_btn-add_hxd3v_12","session-item":"_session-item_hxd3v_23",icon:Ke,focus:ze,"session-item-left":"_session-item-left_hxd3v_46","session-title":"_session-title_hxd3v_50","scroll-list":"_scroll-list_hxd3v_56"};function Ve(){const[e,{setTrue:s,setFalse:o}]=q(!1);return r(O,{children:[t(j,{type:"primary",danger:!0,style:{marginTop:10},onClick:s,children:"领支付宝红包"}),r(me,{autoplay:!0,style:{marginTop:10},children:[t("div",{children:t("a",{href:"https://curl.qcloud.com/3MSaxbee",target:"_blank",children:t("img",{src:m("tencent.jpg"),style:{width:"100%"}})})}),t("div",{children:t("a",{href:"https://curl.qcloud.com/lG1rtroV",target:"_blank",children:t("img",{src:m("rhino-design-560x300.png"),style:{width:"100%"}})})}),t("div",{children:t("a",{href:"https://curl.qcloud.com/YHpNpJ4Q",target:"_blank",children:t("img",{src:m("new-user-560x300.jpg"),style:{width:"100%"}})})})]}),t(z,{title:"扫码领红包",open:e,closeIcon:!1,footer:()=>t(j,{type:"primary",onClick:o,children:"关闭"}),children:t("div",{style:{textAlign:"center"},children:t("img",{src:m("hongbao.jpg"),style:{height:400}})})})]})}function Ye(e){const s=M();return new Promise((o,i)=>{fetch("https://ai.nieyunliang.com/send_message",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({account:s==null?void 0:s.account,messages:e})}).then(n=>n.json()).then(async n=>{o(n)}).catch(()=>{i()})})}function Qe(e){return new Promise((s,o)=>{fetch("https://ai.nieyunliang.com/vip_state",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({account:e})}).then(i=>i.json()).then(async i=>{s(i)}).catch(()=>{o()})})}let D=_e;function We(){const e=V.useApp();return D=e.message,e.notification,e.modal,null}function Xe(){const e=M(),[s,{setTrue:o,setFalse:i}]=q(!1),{runAsync:n,loading:c}=se(d=>Qe(d||(e==null?void 0:e.account)),{manual:!(e!=null&&e.account),onSuccess:d=>{if(d.data){if(d.data.expire<Date.now()){D.warning("您的PLUS服务过期啦！");return}localStorage.setItem("plus",JSON.stringify(d.data)),i()}else D.warning("账号不存在")}}),a=b.useRef(),f=()=>{var h,l;const d=(l=(h=a.current)==null?void 0:h.input)==null?void 0:l.value;d&&n(d)};return r(O,{children:[t("div",{style:{marginBottom:4,textAlign:"center"},children:t("a",{href:"https://github.com/nieyunliang/nieyunliang.com/issues",target:"_blank",children:t("img",{src:m("github.svg"),style:{width:30}})})}),E()?r(O,{children:[t(A,{theme:{token:{colorPrimary:"#8902ea"}},children:r(j,{type:"primary",children:[t("img",{src:m("vip.svg"),style:{width:20}}),t("span",{style:{verticalAlign:"top"},children:"已升级PLUS"})]})}),r("p",{style:{marginTop:6,color:"#eee",textAlign:"center",fontSize:12},children:["PLUS到期时间：",e!=null&&e.expire?B(e.expire):""]})]}):r(j,{type:"primary",ghost:!0,onClick:o,children:["升级PLUS ",t(pe,{})]}),t(z,{forceRender:!0,closeIcon:!1,title:"升级 PLUS 提示",open:s,okButtonProps:{loading:c},cancelText:"取消",okText:"确定",onCancel:i,onOk:f,children:r(k,{direction:"vertical",children:[r("p",{children:[t(P,{twoToneColor:"#11a37f"})," 访问最强大的模型 GPT-4"]}),r("p",{children:[t(P,{twoToneColor:"#11a37f"})," 更快的响应速度"]}),r("p",{children:[t(P,{twoToneColor:"#11a37f"})," 更强大的推理能力"]}),t("p",{children:"有付费意愿的同学，可以通过掘金私信开通账号，月付￥20"}),t("p",{children:t("a",{href:"https://juejin.cn/user/553809590105117",target:"_blank",rel:"noopener noreferrer",children:"访问掘金私信"})}),t(Y,{ref:a,placeholder:"填写您开通的账号，开始使用GPT-4"})]})})]})}function Ze(e){const s=new X,[o,i]=b.useState([]),n=async()=>{const l=await s.get();i(l),e.onRefreshFinish()};b.useEffect(()=>{e.refresh&&n()},[e.refresh]);const[c,a]=b.useState(null),f=l=>{a(l.id),e.onSessionChange(l.store_name)},d=async({id:l,store_name:w})=>{if(await s.removeData(l)){e.onRemoveSession(w);const x=o.findIndex(y=>y.id===l);~x&&(o.splice(x,1),i([...o]))}},h=()=>{a(null),e.onNewSession()};return r("div",{className:v.container,children:[r("div",{className:v["btn-add"],onClick:()=>!e.loading&&h(),children:[t(ve,{}),"创建新的会话"]}),t("div",{className:v["scroll-list"],children:o==null?void 0:o.map(l=>r("div",{className:`${v["session-item"]} ${l.id===c&&v.focus}`,onClick:()=>{!e.loading&&f(l)},children:[r("div",{className:v["session-item-left"],children:[t("img",{width:24,src:m("message.svg"),style:{marginRight:4},alt:""}),t("div",{className:v["session-title"],children:l.title})]}),t(be,{className:v.icon,onClick:w=>{w.stopPropagation(),!e.loading&&d(l)}})]},l.id))}),t(Xe,{}),t(Ve,{})]})}const et="_right_coqhc_15",tt="_bubble_coqhc_18",st="_sender_coqhc_22",nt="_cursor_coqhc_47",ot="_blink_coqhc_1",it="_hljs_coqhc_52",_={"messages-box":"_messages-box_coqhc_1","message-item":"_message-item_coqhc_9",right:et,bubble:tt,sender:st,cursor:nt,blink:ot,hljs:it};function ct({content:e}){const s=new le(de({langPrefix:"hljs language-",highlight(i){if(i)try{return he.highlightAuto(i).value}catch(n){console.log(n)}}}));return s.use(ue()),s.use(ge({prefix:"my-prefix-"})),t("pre",{dangerouslySetInnerHTML:((i="")=>({__html:s.parse(i)}))(e)})}function rt({message:e}){return r("div",{className:_["message-item"],children:[r(k,{className:_.sender,children:[E()?t("img",{src:m("chatgpt-plus-icon.svg"),style:{width:30}}):t("img",{src:m("chatgpt-icon.svg"),style:{width:30}}),t("div",{children:B(e.created_time)})]}),t("div",{className:_.bubble,children:t(ct,{content:e.content})})]})}function at({message:e}){return r("div",{className:`${_["message-item"]} ${_.right}`,children:[r(k,{className:_.sender,children:[t("div",{children:B(e.created_time)}),t("img",{src:m("user-header.svg"),style:{width:30}})]}),t("div",{className:_.bubble,children:e.content})]})}function lt({message:e}){return e.role==="assistant"?t(rt,{message:e}):t(at,{message:e})}function dt({messages:e,loading:s,error:o}){return r("div",{id:"messages-box",className:_["messages-box"],children:[e.map(i=>t(lt,{message:i},i.id)),s?r("div",{className:_["message-item"],children:[t(k,{className:_.sender,children:t("img",{src:m("chatgpt-icon.svg"),style:{width:30}})}),t("div",{className:_.bubble,children:t("span",{className:_.cursor,children:"|"})})]}):null,o?t(ye,{message:o,type:"error",showIcon:!0}):null]})}const{Sider:ut,Content:gt,Footer:ht}=I;function ft(){const e=()=>`chat_${Date.now()}`,[s,o]=b.useState(!0),[i,n]=b.useState(e()),[c,a]=b.useState(""),[f,d]=b.useState(""),h=ne([]),[l,{setTrue:w,setFalse:U}]=q(!1),x=()=>{n(e()),d(""),h.length=0},y=document.getElementById("messages-box"),p=y==null?void 0:y.lastChild;oe(()=>{const g=p==null?void 0:p.offsetTop,u=p==null?void 0:p.offsetHeight;y.scrollTo({top:g+u,behavior:"smooth"})},[p==null?void 0:p.offsetHeight]);const Z=g=>{Ye(g).then(async u=>{if(u.message){d(`服务器出错了！[${u.name}: ${u.message}]`);return}const C=await H({...u.choices[0].message,id:u.id});h.push({...C})}).catch(()=>{d("请求出错了！")}).finally(()=>{U()})},H=async g=>{const u=i||e(),C=await R(u);if(console.log(`是否包含存储对象${u}:${C}`),C)return await $(u,g);if(await Q(u,["role","content"]))return await new X().addData({store_name:u,title:g.content}),o(!0),n(u),await $(u,g)},G=async()=>{if(l||!c)return;w();const g=await H({role:"user",content:c});h.push(g),a(""),d(""),Z([...h])},ee=async g=>{if(g===i)return;n(g),d(""),h.length=0;const u=await W(g);Array.isArray(u)&&h.push(...u)};return r(I,{style:{height:"100vh"},children:[!Fe()&&t(ut,{width:260,children:t(Ze,{loading:l,refresh:s,onRefreshFinish:()=>o(!1),onSessionChange:ee,onNewSession:x,onRemoveSession:x})}),r(I,{children:[t(gt,{children:t(dt,{messages:h,loading:l,error:f})}),t(ht,{children:t("div",{className:K["input-box"],children:t(A,{theme:{token:{colorPrimary:"#11a37f"}},children:t(Y,{size:"large",value:c,suffix:t("img",{alt:"",className:K["btn-send"],src:E()?m("send-plus.svg"):m("send.svg"),onClick:G}),onChange:g=>a(g.target.value),onKeyUp:g=>{g.key==="Enter"&&G()}})})})})]})]})}function mt(){return t(ie,{children:r(ce,{children:[t(J,{path:"/",element:t(je,{})}),t(J,{path:"/chatai",element:t(ft,{})})]})})}function _t(){return t(mt,{})}re.createRoot(document.getElementById("root")).render(t(ae.StrictMode,{children:t(A,{theme:{token:{colorPrimary:"#11a37f"}},children:r(V,{children:[t(_t,{}),t(We,{})]})})}));export{Ct as c,jt as g};
