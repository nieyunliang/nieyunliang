import{p as E,q as U,r as v,v as z,x as J,y as K,B as Y,z as V,A as B,D as Q,R as W}from"./react-7628278b.js";import{M as X,m as Z,a as ee,g as te,H as se}from"./code-highlight-16b0e174.js";import{x as ne}from"./vendor-8dd5318d.js";import{P as oe,D as ie,C as ce,S as I,A as re,L as D,a as ae,I as le}from"./ant-79949c73.js";import"./lodash-668a76bd.js";import"./index-d3722a3d.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();var it=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ct(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const t=E.jsx,u=E.jsxs;const de="_container_by9wd_1",ue="_logo_by9wd_7",he="_title_by9wd_21",ge="_blink_by9wd_1",C={container:de,logo:ue,title:he,blink:ge},fe="/assets/chatgpt-logo-af7ec635.svg";function me(){const e=U(),s=i=>{i.code==="Enter"&&e("/chatai")};return window.removeEventListener("keyup",s),window.addEventListener("keyup",s),u("div",{className:C.container,children:[u("div",{className:C.logo,children:[t("img",{src:fe,style:{width:38}}),t("h1",{children:"GPT-4："})]}),t("h1",{className:C.title,children:"What do you want to do ?"})]})}const O={"input-box":"_input-box_2s0xp_1","btn-send":"_btn-send_2s0xp_4"},_e="/assets/chatgpt-icon-5f52f53f.svg",be="/assets/chatgpt-logo-af7ec635.svg",pe="/assets/message-c4de63a4.svg",ve="/assets/new-user-560x300-e92086dd.jpg",we="/assets/react-35ef61ed.svg",ye="/assets/rhino-design-560x300-b4d777e1.png",xe="/assets/send-9a7ea57f.svg",Se="/assets/tencent-893fb934.jpg",Ne="/assets/user-header-a888db8c.svg",p=e=>new URL(Object.assign({"../assets/chatgpt-icon.svg":_e,"../assets/chatgpt-logo.svg":be,"../assets/message.svg":pe,"../assets/new-user-560x300.jpg":ve,"../assets/react.svg":we,"../assets/rhino-design-560x300.png":ye,"../assets/send.svg":xe,"../assets/tencent.jpg":Se,"../assets/user-header.svg":Ne})[`../assets/${e}`],self.location).href,M=e=>{if(Number.isInteger(e)){const s=new Date(e),i=s.getFullYear(),c=`0${s.getMonth()+1}`.slice(-2),n=s.getDate(),o=s.getHours(),r=`0${s.getMinutes()}`.slice(-2),g=`0${s.getSeconds()}`.slice(-2);return`${i}-${c}-${n} ${o}:${r}:${g}`}else return e},je=()=>{const{userAgent:e}=window.navigator;return!!~e.indexOf("iPhone")||!!~e.indexOf("Android")},Ce="chats";function L(){return Number(localStorage.getItem("indexedDBversion")||1)}function De(e){localStorage.setItem("indexedDBversion",e)}function S(e=L()){return new Promise((s,i)=>{const n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(Ce,e);n.onsuccess=function(o){console.log("数据库打开成功");const r=o.target.result;s(r)},n.onerror=function(o){console.log("数据库打开报错",o),i(o)},n.onupgradeneeded=function(o){console.log("onupgradeneeded");const r=o.target.result;De(r.version),s(r)}})}function N(e){e.close(),console.log("数据库已关闭")}async function R(e){const s=L(),i=await S(s),c=i.objectStoreNames.contains(e);return N(i),c}async function A(e,s){const i=L(),c=await S(i+1),n=c.createObjectStore(e,{keyPath:"sequence_id",autoIncrement:!0});return n.createIndex("id","id",{unique:!1}),n.createIndex("created_time","created_time",{unique:!1}),s.forEach(o=>n.createIndex(o,o,{unique:!1})),N(c),!0}async function $(e,s){const i=await S();return new Promise((c,n)=>{const o={...s,created_time:Date.now()};o.id||Object.assign(o,{id:ne()});const r=i.transaction([e],"readwrite").objectStore(e).add(o);r.onsuccess=function(){console.log("数据写入成功"),N(i),c(o)},r.onerror=function(){console.log("数据写入失败"),n(!1)}})}async function H(e){const s=await S(),i=s.transaction(e,"readwrite").objectStore(e);return new Promise(c=>{const n=[],o=i.openCursor();o.onsuccess=function(r){const g=r.target.result;g?(n.push(g.value),g.continue()):(console.log("游标读取的数据：",n),N(s),c(n))}})}async function Re(e,s,i){const c=await S(),n=c.transaction(e,"readwrite").objectStore(e);return new Promise((o,r)=>{const g=n.index(s).openCursor(IDBKeyRange.only(i));g.onsuccess=function(m){const h=m.target.result;let a;h&&(a=h.delete(),a.onerror=function(){console.log("游标删除该记录失败")},a.onsuccess=function(){console.log("游标删除该记录成功"),N(c),o(!0)},h.continue())},g.onerror=function(m){r(m)}})}class T{constructor(){this.storeName="store_session_list"}async get(){return await R(this.storeName)?H(this.storeName):(await this.createSessionListStore(),[])}async createSessionListStore(){if(!await R(this.storeName))return await A(this.storeName,["store_name","title"])}async addData(s){return await $(this.storeName,s)}async removeData(s){return await Re(this.storeName,"id",s)}}const $e="_container_hxd3v_1",Ie="_icon_hxd3v_34",Le="_focus_hxd3v_40",b={container:$e,"btn-add":"_btn-add_hxd3v_12","session-item":"_session-item_hxd3v_23",icon:Ie,focus:Le,"session-item-left":"_session-item-left_hxd3v_46","session-title":"_session-title_hxd3v_50","scroll-list":"_scroll-list_hxd3v_56"};function ke(e){const s=new T,[i,c]=v.useState([]),n=async()=>{const a=await s.get();c(a),e.onRefreshFinish()};v.useEffect(()=>{e.refresh&&n()},[e.refresh]);const[o,r]=v.useState(null),g=a=>{r(a.id),e.onSessionChange(a.store_name)},m=async({id:a,store_name:y})=>{if(await s.removeData(a)){e.onRemoveSession(y);const x=i.findIndex(w=>w.id===a);~x&&(i.splice(x,1),c([...i]))}},h=()=>{r(null),e.onNewSession()};return u("div",{className:b.container,children:[u("div",{className:b["btn-add"],onClick:()=>!e.loading&&h(),children:[t(oe,{}),"创建新的会话"]}),t("div",{className:b["scroll-list"],children:i==null?void 0:i.map(a=>u("div",{className:`${b["session-item"]} ${a.id===o&&b.focus}`,onClick:()=>{!e.loading&&g(a)},children:[u("div",{className:b["session-item-left"],children:[t("img",{width:24,src:p("message.svg"),style:{marginRight:4},alt:""}),t("div",{className:b["session-title"],children:a.title})]}),t(ie,{className:b.icon,onClick:y=>{y.stopPropagation(),!e.loading&&m(a)}})]},a.id))}),u(ce,{autoplay:!0,children:[t("div",{children:t("a",{href:"https://curl.qcloud.com/3MSaxbee",target:"_blank",children:t("img",{src:p("tencent.jpg"),style:{width:"100%"}})})}),t("div",{children:t("a",{href:"https://curl.qcloud.com/lG1rtroV",target:"_blank",children:t("img",{src:p("rhino-design-560x300.png"),style:{width:"100%"}})})}),t("div",{children:t("a",{href:"https://curl.qcloud.com/YHpNpJ4Q",target:"_blank",children:t("img",{src:p("new-user-560x300.jpg"),style:{width:"100%"}})})})]})]})}const qe="_right_coqhc_15",Pe="_bubble_coqhc_18",Be="_sender_coqhc_22",Oe="_cursor_coqhc_47",Ee="_blink_coqhc_1",Me="_hljs_coqhc_52",f={"messages-box":"_messages-box_coqhc_1","message-item":"_message-item_coqhc_9",right:qe,bubble:Pe,sender:Be,cursor:Oe,blink:Ee,hljs:Me};function Ae({content:e}){const s=new X(Z({langPrefix:"hljs language-",highlight(c){if(c)try{return se.highlightAuto(c).value}catch(n){console.log(n)}}}));return s.use(ee()),s.use(te({prefix:"my-prefix-"})),t("pre",{dangerouslySetInnerHTML:((c="")=>({__html:s.parse(c)}))(e)})}function He({message:e}){return u("div",{className:f["message-item"],children:[u(I,{className:f.sender,children:[t("img",{src:p("chatgpt-icon.svg"),style:{width:30}}),t("div",{children:M(e.created_time)})]}),t("div",{className:f.bubble,children:t(Ae,{content:e.content})})]})}function Te({message:e}){return u("div",{className:`${f["message-item"]} ${f.right}`,children:[u(I,{className:f.sender,children:[t("div",{children:M(e.created_time)}),t("img",{src:p("user-header.svg"),style:{width:30}})]}),t("div",{className:f.bubble,children:e.content})]})}function Fe({message:e}){return e.role==="assistant"?t(He,{message:e}):t(Te,{message:e})}function Ge({messages:e,loading:s,error:i}){return u("div",{id:"messages-box",className:f["messages-box"],children:[e.map(c=>t(Fe,{message:c},c.id)),s?u("div",{className:f["message-item"],children:[t(I,{className:f.sender,children:t("img",{src:p("chatgpt-icon.svg"),style:{width:30}})}),t("div",{className:f.bubble,children:t("span",{className:f.cursor,children:"|"})})]}):null,i?t(re,{message:i,type:"error",showIcon:!0}):null]})}function Ue(e){return new Promise((s,i)=>{fetch("https://ai.nieyunliang.com/send_message",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({messages:e})}).then(c=>c.json()).then(async c=>{s(c)}).catch(()=>{i()})})}const{Sider:ze,Content:Je,Footer:Ke}=D;function Ye(){const e=()=>`chat_${Date.now()}`,[s,i]=v.useState(!0),[c,n]=v.useState(e()),[o,r]=v.useState(""),[g,m]=v.useState(""),h=z([]),[a,{setTrue:y,setFalse:k}]=J(!1),x=()=>{n(e()),m(""),h.length=0},w=document.getElementById("messages-box"),_=w==null?void 0:w.lastChild;K(()=>{const d=_==null?void 0:_.offsetTop,l=_==null?void 0:_.offsetHeight;w.scrollTo({top:d+l,behavior:"smooth"})},[_==null?void 0:_.offsetHeight]);const F=d=>{Ue(d).then(async l=>{if(l.message){m(`服务器出错了！[${l.name}: ${l.message}]`);return}const j=await q({...l.choices[0].message,id:l.id});h.push({...j})}).catch(()=>{m("请求出错了！")}).finally(()=>{k()})},q=async d=>{const l=c||e(),j=await R(l);if(console.log(`是否包含存储对象${l}:${j}`),j)return await $(l,d);if(await A(l,["role","content"]))return await new T().addData({store_name:l,title:d.content}),i(!0),n(l),await $(l,d)},P=async()=>{if(a||!o)return;y();const d=await q({role:"user",content:o});h.push(d),r(""),m(""),F([...h])},G=async d=>{if(d===c)return;n(d),m(""),h.length=0;const l=await H(d);Array.isArray(l)&&h.push(...l)};return u(D,{style:{height:"100vh"},children:[!je()&&t(ze,{width:260,children:t(ke,{loading:a,refresh:s,onRefreshFinish:()=>i(!1),onSessionChange:G,onNewSession:x,onRemoveSession:x})}),u(D,{children:[t(Je,{children:t(Ge,{messages:h,loading:a,error:g})}),t(Ke,{children:t("div",{className:O["input-box"],children:t(ae,{theme:{token:{colorPrimary:"#11a37f"}},children:t(le,{size:"large",value:o,suffix:t("img",{alt:"",className:O["btn-send"],src:p("send.svg"),onClick:P}),onChange:d=>r(d.target.value),onKeyUp:d=>{d.key==="Enter"&&P()}})})})})]})]})}function Ve(){return t(Y,{children:u(V,{children:[t(B,{path:"/",element:t(me,{})}),t(B,{path:"/chatai",element:t(Ye,{})})]})})}function Qe(){return t(Ve,{})}Q.createRoot(document.getElementById("root")).render(t(W.StrictMode,{children:t(Qe,{})}));export{it as c,ct as g};
